/*! angular-spotify 2014-12-21 */
(function(e,t,n){"use strict";t.module("spotify",[]).provider("Spotify",function(){var n={};n.clientId=null;n.redirectUri=null;n.scope=null;n.accessToken=null;this.setClientId=function(e){n.clientId=e;return n.clientId};this.getClientId=function(){return n.clientId};this.setRedirectUri=function(e){n.redirectUri=e;return n.redirectUri};this.getRedirectUri=function(){return n.redirectUri};this.setScope=function(e){n.scope=e;return n.scope};var r={};r.toQueryString=function(e){var n=[];t.forEach(e,function(e,t){this.push(encodeURIComponent(t)+"="+encodeURIComponent(e))},n);return n.join("&")};n.apiBase="https://api.spotify.com/v1";this.$get=["$q","$http","$window",function(i,s,o){function u(){this.clientId=n.clientId;this.redirectUri=n.redirectUri;this.apiBase=n.apiBase;this.scope=n.scope;this.accessToken=null;this.toQueryString=r.toQueryString}u.prototype.api=function(e,t,n,r,o){var u=i.defer();s({url:this.apiBase+e,method:t?t:"GET",params:n,data:r,headers:o}).success(function(e){u.resolve(e)}).error(function(e){u.reject(e)});return u.promise};u.prototype.search=function(e,t,n){n=n||{};n.q=e;n.type=t;return this.api("/search","GET",n)};u.prototype.getAlbum=function(e){e=e.indexOf("spotify:")===-1?e:e.split(":")[2];return this.api("/albums/"+e)};u.prototype.getAlbums=function(e){e=t.isString(e)?e.split(","):e;t.forEach(e,function(t,n){e[n]=t.indexOf("spotify:")>-1?t.split(":")[2]:t});return this.api("/albums","GET",{ids:e?e.toString():""})};u.prototype.getAlbumTracks=function(e,t){e=e.indexOf("spotify:")===-1?e:e.split(":")[2];return this.api("/albums/"+e+"/tracks","GET",t)};u.prototype.getArtist=function(e){e=e.indexOf("spotify:")===-1?e:e.split(":")[2];return this.api("/artists/"+e)};u.prototype.getArtists=function(e){e=t.isString(e)?e.split(","):e;t.forEach(e,function(t,n){e[n]=t.indexOf("spotify:")>-1?t.split(":")[2]:t});return this.api("/artists/","GET",{ids:e?e.toString():""})};u.prototype.getArtistAlbums=function(e,t){e=e.indexOf("spotify:")===-1?e:e.split(":")[2];return this.api("/artists/"+e+"/albums","GET",t)};u.prototype.getArtistTopTracks=function(e,t){e=e.indexOf("spotify:")===-1?e:e.split(":")[2];return this.api("/artists/"+e+"/top-tracks","GET",{country:t})};u.prototype.getRelatedArtists=function(e){e=e.indexOf("spotify:")===-1?e:e.split(":")[2];return this.api("/artists/"+e+"/related-artists")};u.prototype.getTrack=function(e){e=e.indexOf("spotify:")===-1?e:e.split(":")[2];return this.api("/tracks/"+e)};u.prototype.getTracks=function(e){e=t.isString(e)?e.split(","):e;t.forEach(e,function(t,n){e[n]=t.indexOf("spotify:")>-1?t.split(":")[2]:t});return this.api("/tracks/","GET",{ids:e?e.toString():""})};u.prototype.getUserPlaylists=function(e,t){return this.api("/users/"+e+"/playlists","GET",t,null,{Authorization:"Bearer "+this.authToken})};u.prototype.getPlaylist=function(e,t,n){return this.api("/users/"+e+"/playlists/"+t,"GET",n,null,{Authorization:"Bearer "+this.authToken})};u.prototype.getPlaylistTracks=function(e,t,n){return this.api("/users/"+e+"/playlists/"+t+"/tracks","GET",n,null,{Authorization:"Bearer "+this.authToken})};u.prototype.createPlaylist=function(e,t){return this.api("/users/"+e+"/playlists","POST",null,t,{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})};u.prototype.addPlaylistTracks=function(e,n,r,i){r=t.isArray(r)?r:r.split(",");t.forEach(r,function(e,t){r[t]=e.indexOf("spotify:")===-1?"spotify:track:"+e:e});return this.api("/users/"+e+"/playlists/"+n+"/tracks","POST",{uris:r.toString(),position:i?i.position:null},null,{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})};u.prototype.removePlaylistTracks=function(e,n,r){r=t.isArray(r)?r:r.split(",");var i;t.forEach(r,function(e,t){i=r[t];r[t]={uri:i.indexOf("spotify:")===-1?"spotify:track:"+i:i}});return this.api("/users/"+e+"/playlists/"+n+"/tracks","DELETE",null,{tracks:r},{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})};u.prototype.replacePlaylistTracks=function(e,n,r){r=t.isArray(r)?r:r.split(",");var i;t.forEach(r,function(e,t){i=r[t];r[t]=i.indexOf("spotify:")===-1?"spotify:track:"+i:i});return this.api("/users/"+e+"/playlists/"+n+"/tracks","PUT",{uris:r.toString()},null,{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})};u.prototype.updatePlaylistDetails=function(e,t,n){return this.api("/users/"+e+"/playlists/"+t,"PUT",null,n,{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})};u.prototype.getUser=function(e){return this.api("/users/"+e)};u.prototype.getCurrentUser=function(){return this.api("/me","GET",null,null,{Authorization:"Bearer "+this.authToken})};u.prototype.getSavedUserTracks=function(e){return this.api("/me/tracks","GET",e,null,{Authorization:"Bearer "+this.authToken})};u.prototype.userTracksContains=function(e){e=t.isString(e)?e.split(","):e;t.forEach(e,function(t,n){e[n]=t.indexOf("spotify:")>-1?t.split(":")[2]:t});return this.api("/me/tracks/contains","GET",{ids:e.toString()},null,{Authorization:"Bearer "+this.authToken})};u.prototype.saveUserTracks=function(e){e=t.isString(e)?e.split(","):e;t.forEach(e,function(t,n){e[n]=t.indexOf("spotify:")>-1?t.split(":")[2]:t});return this.api("/me/tracks","PUT",{ids:e.toString()},null,{Authorization:"Bearer "+this.authToken})};u.prototype.removeUserTracks=function(e){e=t.isString(e)?e.split(","):e;t.forEach(e,function(t,n){e[n]=t.indexOf("spotify:")>-1?t.split(":")[2]:t});return this.api("/me/tracks","DELETE",{ids:e.toString()},null,{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})};u.prototype.getFeaturedPlaylists=function(e){return this.api("/browse/featured-playlists","GET",e,null,{Authorization:"Bearer "+this.authToken})};u.prototype.getNewReleases=function(e){return this.api("/browse/new-releases","GET",e,null,{Authorization:"Bearer "+this.authToken})};u.prototype.setAuthToken=function(e){this.authToken=e;return this.authToken};u.prototype.login=function(){function c(e){if(e.key==="spotify-token"){if(l){l.close()}n.setAuthToken(e.newValue);o.removeEventListener("storage",c,false);t.resolve(e.newValue)}}var t=i.defer();var n=this;var r=400,s=500,u=screen.width/2-r/2,a=screen.height/2-s/2;var f={client_id:this.clientId,redirect_uri:this.redirectUri,scope:this.scope||"",response_type:"token"};var l=e.open("https://accounts.spotify.com/authorize?"+this.toQueryString(f),"Spotify","menubar=no,location=no,resizable=yes,scrollbars=yes,status=no,width="+r+",height="+s+",top="+a+",left="+u);o.addEventListener("storage",c,false);return t.promise};return new u}]})})(window,angular)